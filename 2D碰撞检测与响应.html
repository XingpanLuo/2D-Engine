<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>
<title>2D碰撞检测与响应</title><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-diagram-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.html-for-mac .inline-math-svg .MathJax_SVG { vertical-align: 0.2px; }
.md-math-block .MathJax_SVG_Display { text-align: center; margin: 0px; position: relative; text-indent: 0px; max-width: none; max-height: none; min-height: 0px; min-width: 100%; width: auto; overflow-y: hidden; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: var(--monospace); }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: 400; line-height: normal; zoom: 90%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; overflow-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none 0s ease 0s; }
.MathJax_SVG_Display svg { vertical-align: middle !important; margin-bottom: 0px !important; margin-top: 0px !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
mark .md-meta { color: rgb(0, 0, 0); opacity: 0.3 !important; }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


@import '';
:root {
    --side-bar-bg-color: #fff;
    --control-text-color: #777;
    --select-text-bg-color: #ffafa3;
    --active-file-text-color: #262626;
    --active-file-border-color: #f22f27;
    /* --active-file-bg-color: #fff3f0; */
    --primary-color: #f22f27;
    /* 中性色 */
    --mid-1: #ffffff;
    --mid-2: #fafafa;
    --mid-3: #f5f5f5;
    --mid-4: #f0f0f0;
    --mid-5: #d9d9d9;
    --mid-6: #bfbfbf;
    --mid-7: #8c8c8c;
    --mid-8: #595959;
    --mid-9: #434343;
    --mid-10: #262626;
    --mid-11: #1f1f1f;
    --mid-12: #141414;
    --mid-13: #000000;
    /* 主题色 */
    --main-1: #fff3f0;
    --main-2: #ffd4cc;
    --main-3: #ffafa3;
    --main-4: #ff887a;
    --main-5: #ff5d52;
    --main-6: #f22f27;
    --main-7: #cc1616;
    --main-8: #a60a0f;
    --main-9: #80010a;
    --main-10: #590009;
}

html {
    font-size: 17px;
}

body {
    font-family: "Vollkorn", Palatino, Times;
    /* font-family: 'Source Han SerifCN', Georgia, Times, 'SimSun', serif!important; */
    color: var(--mid-13);
    -webkit-font-smoothing: antialiased;
    line-height: 1.8rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

#write {
    max-width: 860px;
    margin: 0 auto;
    padding: 20px 30px 160px;
}

#write p {
    line-height: 1.8rem;
    word-spacing: .05rem;
    /* color: #3f3f3f; */
    color: var(--mid-13);
}


/* #write ol li {
    padding-left: 0.5rem;
} */

#write>ul:first-child,
#write>ol:first-child {
    margin-top: 30px;
}

body>*:first-child {
    margin-top: 0 !important;
}

body>*:last-child {
    margin-bottom: 0 !important;
}


/* a {
    color: var(--main-6);
    font-weight: 500;
    padding: 0 2px;
    text-decoration: none;
} */

a {
    color: blue;
    font-weight: 500;
    padding: 0 2px;
    text-decoration: none;
}


/* 链接 */


/* #write a {
    border-bottom: 1px solid var(--main-6);
    color: var(--main-6);
    text-decoration: none;
} */

#write a {
    border-bottom: 1px solid blue;
    color: blue;
    text-decoration: none;
}


/* 目录 */

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
}

#write a:hover {
    border-bottom: 2px solid var(--main-6);
    color: var(--main-7);
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}

h2 tt,
h2 code {
    font-size: inherit !important;
}

h3 tt,
h3 code {
    font-size: inherit !important;
}

h4 tt,
h4 code {
    font-size: inherit !important;
}

h5 tt,
h5 code {
    font-size: inherit !important;
}

h6 tt,
h6 code {
    font-size: inherit !important;
}

h2 a,
h3 a {
    color: #34495e;
}

h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
    color: var(--main-10);
}

h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--main-6);
}

h2 {
    margin: 2em auto 1.4em;
    /* padding-left: 10px; */
    /* display:inline-block; */
    line-height: 1.4;
    font-size: 1.8em;
    /* border-left: 9px solid var(--main-6); */
    /* border-bottom: 1px solid #ddd; */
    border-bottom: 1px solid var(--main-6);
}

h2::before {
    content: '# '!important;
    color: #f22f27;
}

h3 {
    font-size: 1.4em;
    line-height: 1.43;
    margin: 1.6em auto 1.2em;
    padding-left: 9px;
    border-left: 5px solid #f22f27;
}


/* 三级四级标题点击后左边的提示图标 */

#write>h3.md-focus:before,
#write>h4.md-focus:before {
    width: auto;
    height: auto;
    background-color: var(--main-5);
    color: var(--mid-1);
}

h4 {
    margin-top: 1.3em;
    font-size: 1.2em;
    padding-left: 6px;
    padding-right: 6px;
    display: inline-block;
    border: 1px solid var(--main-6);
    border-top: 4px solid var(--main-6);
}

#write h5::before,
#write h6::before {
    position: absolute;
    right: calc(100% + .75em);
    top: 0;
    color: #5b5b5b;
    font-size: 0.8rem;
    font-weight: bold;
    font-variant: 'small-caps';
    white-space: nowrap;
    /* 文本强制不换行 */
    border: 0;
}

#write h5 {
    /* margin-left: 2em; */
    font-size: 1rem;
}

#write h6 {
    /* margin-left: 2.5em; */
    font-size: 1rem;
}

#write h5::before {
    content: 'H5';
    top: 0.18rem;
}

#write h6::before {
    content: 'H6';
    top: 0.18rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li>ol,
li>ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body>h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body>h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body>h1:first-child+h2 {
    margin-top: 0;
    padding-top: 0;
}

body>h3:first-child,
body>h4:first-child,
body>h5:first-child,
body>h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

#write ol,
#write ul {
    padding-left: 25px;
    margin: .5rem 0;
}

#write ol>li,
#write ul>li {
    color: #db4d52;
    font-weight: bold;
}

#write ol>li>*,
#write ul>li>* {
    color: #333;
    font-weight: normal;
}

#write ol>li>*:not(ol):not(ul),
#write ul>li>*:not(ol):not(ul) {
    padding-left: .25rem;
}

#write ul {
    list-style-type: disc;
}

blockquote {
    border-left: 4px solid rgb(239, 112, 96);
    padding: 10px 15px;
    color: #3f3f3f;
    background-color: #fff9f9;
}

table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid var(--main-6);
    margin: 0;
    padding: 0;
}

table tr:nth-child(2n),
thead {
    background-color: #fafafa;
}

table tr th {
    font-weight: bold;
    border: 1px solid var(--main-6);
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid var(--main-6);
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

#write strong {
    padding: 0.1em;
    color: #dc3545;
}

#write em {
    padding: 0 2px 0 2px;
    font-style: normal;
    color: #ff3502;
    /* color: #595959;
    background: #F6EEFF; */
}


/* 数学公式变蓝 */

[md-inline='inline_math'] {
    color: blue;
    font-size: 100%;
}


/* 表格第一行 */


/* #write table thead th {
    background-color: var(--main-7);
    color: #f8f8f8;
} */


/* 行号左框线 */

#write .CodeMirror-gutters {
    border-right: 1px solid rgba(204, 51, 0);
}


/* 代码框 */

#write .md-fences {
    border: 1px solid #7a7a7a;
    -webkit-font-smoothing: initial;
    margin: 2rem 0 !important;
    /* padding: 0.3rem 0 !important; */
    padding: 3px 5px;
    line-height: 1.55rem;
    border-radius: 2px;
    font-family: 'Roboto Mono', 'Source Sans Pro', 'Microsoft YaHei', '微软雅黑' !important;
    font-size: 0.9rem;
    word-wrap: normal;
}

#write [mdtype="math_block"] {
    font-size: 1.2rem;
}

#write .CodeMirror-wrap .CodeMirror-code pre {
    padding-left: 12px;
    line-height: 1.55rem;
}

.cm-s-inner .CodeMirror-linenumber {
    width: 2ch !important;
    color: rgba(128, 128, 255, 0.8);
}

#write .CodeMirror-cursors .CodeMirror-cursor {
    border-left: 2px solid var(--main-4);
}


/* 行间代码 */

#write code,
tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: 'Source Code Pro', Roboto Mono, Source Sans Pro, 'Microsoft YaHei', '微软雅黑' !important;
    font-size: 0.92rem;
    color: #ff3502;
    background-color: #f8f5ec;
    /* color: #c7254e;
    background-color: #f9f2f4;  */
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: #e96900;
}


/* 流程图块 */

#write .md-diagram-panel {
    position: relative;
    margin: 24px auto;
}

#write .md-focus .md-diagram-panel {
    border: 1px solid var(--main-4);
    border-radius: 4px;
}


/* heighlight. */

#write mark {
    background-color: #EBFFEB;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
    color: #222;
    font-weight: 500;
}

#write del {
    padding: 1px 2px;
}

.cm-s-inner .cm-link,
.cm-s-inner.cm-link {
    color: #22a2c9;
}

.cm-s-inner .cm-string {
    color: #22a2c9;
}


/* 任务列表小方框 */

.md-task-list-item>input {
    margin-left: -1.3em;
    margin-top: 0.3rem;
    -webkit-appearance: none;
}

.md-task-list-item>input:before {
    content: '';
    display: inline-block;
    width: 0.875rem;
    height: 0.875rem;
    vertical-align: middle;
    text-align: center;
    font-size: 0.8rem;
    color: var(--mid-1);
    border-radius: 2px;
    border: 1px solid var(--main-4);
    margin-top: -0.4rem;
    transition: all 0.2s linear;
}

.md-task-list-item>input:checked:before,
.md-task-list-item>input[checked]:before {
    content: '\2714';
    font-size: 0.625rem;
    color: var(--mid-1);
    border: 1px solid var(--main-6);
    background-color: var(--main-6);
}


/* @media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
} */


/* .md-fences {
    background-color: #f8f8f8;
} */

#write pre.md-meta-block {
    /* padding: 1rem; */
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
    bottom: .375rem;
    /* bottom: .575rem; */
}

#write>h3.md-focus:before {
    left: -1.5625rem;
    top: .375rem;
}

#write>h4.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write>h5.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write>h6.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}


/*--- 图片 ---*/

.md-image {
    margin: 24px auto;
    border-radius: 4px;
}

.md-image img {
    border-radius: 4px;
}


/* 当 “![shadow-随便写]()”写时，会有阴影 */

.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow: #84A1A8 0px 10px 15px;
}

.md-image>.md-meta {
    border-radius: 3px;
    font-family: Consolas, 'Liberation Mono', Courier, monospace;
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: inherit;
}

.md-toc {
    margin-top: 20px;
    padding-bottom: 20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}


/** focus mode */

.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: 'Segoe UI', 'Arial', sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #e6f0fe;
}


/* 侧边栏 */

.file-list-item.active {
    background: var(--active-file-bg-color);
    color: var(--active-file-text-color);
    border-left: 4px solid var(--main-6);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--active-file-bg-color);
    border-left: 4px solid var(--main-6);
    border-color: var(--active-file-border-color);
}

@media print {
    .typora-export * {
        -webkit-print-color-adjust: exact;
    }
    html {
        font-size: 16px!important;
    }
    body {
        /* font-family: 'Source Han SerifCN', Georgia, Times, 'SimSun', serif!important; */
        /* font-size: 16px!important; */
        font-family: Times, 'SimSun', serif!important;
        color: #000000!important;
    }
    p {
        color: #000000!important;
    }
    a {
        color: blue!important;
        /* border-bottom: 1px solid blue!important; */
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

 :root {--mermaid-font-zoom:1em ;} 
</style>
</head>
<body class='typora-export os-windows'>
<div id='write'  class=''><h1><a name="2d碰撞检测与响应" class="md-header-anchor"></a><span>2D碰撞检测与响应</span></h1><h1><a name="工程科学学院-罗兴攀-pb19051150" class="md-header-anchor"></a><span>工程科学学院 罗兴攀 PB19051150 </span></h1><h2><a name="科学技术原理" class="md-header-anchor"></a><span>科学技术原理</span></h2><ul><li><span>AABB盒碰撞检测</span></li><li><span>SAT碰撞检测</span></li><li><span>最近点法碰撞点检测</span></li><li><span>碰撞响应的约束-冲量方案</span></li><li><span>碰撞响应的优化</span></li></ul><h2><a name="运行说明" class="md-header-anchor"></a><span>运行说明</span></h2><ul><li><p><span>双击运行./dist/main.exe即可。</span><strong><span>由于压缩包不能大于1MB，故提交的压缩包里并没有dist文件夹，只能用自己的PC演示</span></strong></p><ul><li><span>这是一个打包好的windows可执行程序。</span></li><li><span>会生成一个GUI界面和一个终端界面。在GUI界面绘图，点击GUI界面中的模拟即可模拟碰撞及响应</span></li></ul></li><li><p><span>也可以在当前目录执行 </span><code>python main.py</code></p><ul><li><span>这可能你要求安装一些需要包。例如</span><code>PyQt5,numpy</code><span>等。</span></li></ul></li></ul><h2><a name="设计方案" class="md-header-anchor"></a><span>设计方案</span></h2><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/34451135/1669386513884-3caa253e-0601-47ce-a6ee-cd7efd2f8f79.jpeg" referrerpolicy="no-referrer"></p><h2><a name="参考资料" class="md-header-anchor"></a><span>参考资料</span></h2><blockquote><p><span>[1]杨先卫,张甫宽. 2D刚体碰撞的实时模拟[C]//.&#39;2006系统仿真技术及其应用学术交流会论文集.,2006:325-328.</span>
<span>[2]黎智洲. 基于最近支持点的碰撞检测算法研究与应用[D].广东工业大学,2022.DOI:10.27029/d.cnki.ggdgu.2022.000694.</span></p></blockquote><h2><a name="pyqt5-绘图" class="md-header-anchor"></a><span>PyQt5 绘图</span></h2><p><span>略。</span>
<span>运行结果：</span>
<span>支持绘制各种基础图形。</span>
<img src="https://cdn.nlark.com/yuque/0/2022/png/34451135/1669295383145-6ae01924-e3d8-4d68-9536-3bb91816de91.png#averageHue=%23646464&amp;clientId=uc09f08c5-d88e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=720&amp;id=u3f23404d&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1080&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=63317&amp;status=done&amp;style=none&amp;taskId=u7090ef44-073f-4f1e-922a-fb6a372506f&amp;title=&amp;width=1280" referrerpolicy="no-referrer" alt="image.png"></p><h2><a name="aabb-sweep粗检测" class="md-header-anchor"></a><span>AABB-Sweep粗检测</span></h2><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/34451135/1669293402246-49431c93-2dbb-4319-8cc7-091b11cc9aa6.jpeg" referrerpolicy="no-referrer">
<span>Sweep and Prune 算法：</span></p><ul><li><span>AABB盒投影至x轴上</span></li><li><span>对轴上区间端点进行升序排序 </span><code>[s1,s2,e1,e2,s3,e3]</code></li><li><span>从左到右扫描投影轴</span></li><li><span>遇到一个开始端点 s(i) ，将 s(i) 所属的 AABB(i) 与 L 中的所有 s 所属的 AABB 进行相交检测, 并将 s(i) 加入至 L</span></li><li><span>遇到一个结束端点 e(i) ，将与同属 e(i) 同属一个AABB 的 s(i) 从 L 中移除</span></li></ul><p><span>算法伪代码:</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 42px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>15</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">AABB_Point</span>():</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span>,<span class="cm-variable">y</span>,<span class="cm-variable">is_start</span>,<span class="cm-builtin">id</span>;</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sweep</span>(<span class="cm-variable">aabb_list</span>):<span class="cm-comment">#aabb_list已经排好序</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">L</span>=[];<span class="cm-variable">coll_list</span>=[];</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">aabb_list</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">i</span>.<span class="cm-property">is_start</span> :</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">L</span>.<span class="cm-property">append</span>(<span class="cm-variable">i</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">j</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">0</span>,<span class="cm-builtin">len</span>(<span class="cm-variable">L</span>)<span class="cm-operator">-</span><span class="cm-number">1</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">coll_list</span>.<span class="cm-property">append</span>(<span class="cm-variable">i</span>.<span class="cm-property">id</span>,<span class="cm-variable">L</span>[<span class="cm-variable">j</span>].<span class="cm-property">id</span>) <span class="cm-comment">#第i.id个盒子与第L[j].id个盒子碰撞</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">j</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">0</span>,<span class="cm-builtin">len</span>(<span class="cm-variable">L</span>)):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">L</span>[<span class="cm-variable">j</span>].<span class="cm-property">id</span>==<span class="cm-variable">i</span>.<span class="cm-property">id</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">del</span> <span class="cm-variable">L</span>[<span class="cm-variable">j</span>]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">break</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">coll_list</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 393px;"></div><div class="CodeMirror-gutters" style="height: 393px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></pre><p><span>运行结果：成功进行AABB粗检测。</span>
<img src="https://cdn.nlark.com/yuque/0/2022/png/34451135/1669295787973-b2256547-b25a-48c4-a90f-b443edb82c37.png#averageHue=%23636363&amp;clientId=uc09f08c5-d88e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=720&amp;id=u97823016&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1080&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=57732&amp;status=done&amp;style=none&amp;taskId=u61b6760d-b3b1-4d37-a5b1-0484a61f2e7&amp;title=%E6%A3%80%E6%B5%8B%E5%88%B0%E5%8C%85%E5%9B%B4%E7%9B%92%E5%8F%91%E7%94%9F%E7%A2%B0%E6%92%9E%E5%B0%B1%E9%9D%99%E6%AD%A2&amp;width=1280" referrerpolicy="no-referrer" alt="image.png" title="检测到包围盒发生碰撞就静止"></p><h2><a name="sat碰撞检测" class="md-header-anchor"></a><span>SAT碰撞检测</span></h2><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/34451135/1669295296613-e83d3bb3-c23e-4a28-a64c-54c3c1326e23.jpeg" referrerpolicy="no-referrer">
<span>算法描述：</span></p><blockquote><p><span>SAT分离轴算法参考: </span><a href='https://github.com/phenomLi/Blog/issues/23'><span>https://github.com/phenomLi/Blog/issues/23</span></a></p></blockquote><ul><li><span>两个多边形的所有边的法线作为可能的分离轴</span></li><li><span>将两个多边形在分离轴上做投影，投影范围为</span><code>[min1,max1],[min2,max2]</code></li><li><span>若存在一个分离轴使得投影范围不重叠，说明没有发生碰撞</span></li><li><span>若所有的分离轴投影范围都重叠，则说明发生了碰撞</span></li><li><span>若发生碰撞，投影重叠区域最小的分离轴就是碰撞法线，重叠区域的长度就是碰撞深度</span></li></ul><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 42px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>18</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">/*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">返回值：</span>(<span class="cm-builtin">bool</span>,<span class="cm-variable">QPointF</span>,<span class="cm-variable">double</span>) : (<span class="cm-variable">是否碰撞，分离轴，碰撞深度</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">只给出两个刚体都是多边形的处理方案</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-operator">*/</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">sat</span>(<span class="cm-variable">body1</span>,<span class="cm-variable">body2</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">axes1</span>=<span class="cm-variable">get_axes</span>(<span class="cm-variable">body1</span>)<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">#body1的分离轴，如果body为多边形，分离轴就是边的法线</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">axes2</span>=<span class="cm-variable">get_axes</span>(<span class="cm-variable">body2</span>)<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">#如果body不是多边形而是圆，要用单独的函数计算分离轴</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">axes_list</span>=<span class="cm-variable">axes1</span><span class="cm-operator">+</span><span class="cm-variable">axes2</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">range_lap_len</span>=[]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">for</span> <span class="cm-variable">axes</span> <span class="cm-keyword">in</span> <span class="cm-variable">axes_list</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">range1</span>=<span class="cm-variable">project</span>(<span class="cm-variable">body1</span>.<span class="cm-property">points_list</span>,<span class="cm-variable">axes</span>)<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">#body1的每个顶点在axes向量上的投影的范围</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">range2</span>=<span class="cm-variable">project</span>(<span class="cm-variable">body2</span>.<span class="cm-property">points_list</span>,<span class="cm-variable">axes</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">overlap_len</span>=<span class="cm-variable">overlap</span>(<span class="cm-variable">range1</span>,<span class="cm-variable">range2</span>)<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">#计算两个线段的重叠区域</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">overlap_len</span>==<span class="cm-number">0</span>:<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-operator">//</span><span class="cm-variable">两条线段无公共区域</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">false</span>,<span class="cm-variable">QPointF</span>(<span class="cm-number">0</span>,<span class="cm-number">0</span>),<span class="cm-number">0</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-operator">//</span><span class="cm-variable">说明未发生碰撞</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  <span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">range_lap_len</span>.<span class="cm-property">append</span>(<span class="cm-variable">overlap_len</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-variable">min_index</span>=<span class="cm-builtin">min</span>(<span class="cm-variable">overlalp_len</span>)<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">#最小元素所在位置，比如第i个元素最小，则min_index=i</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-keyword">return</span> <span class="cm-variable">true</span>,<span class="cm-variable">axes_list</span>[<span class="cm-variable">min_index</span>],<span class="cm-variable">range_lap_len</span>[<span class="cm-variable">min_index</span>]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 484px;"></div><div class="CodeMirror-gutters" style="height: 484px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></pre><p><span>运行结果：成功进行碰撞检测</span>
<img src="https://cdn.nlark.com/yuque/0/2022/png/34451135/1669295977104-5445f097-20cd-4aa5-ad0b-da235dccd7a0.png#averageHue=%23646464&amp;clientId=uc09f08c5-d88e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=720&amp;id=ue5b9d7eb&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1080&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=55815&amp;status=done&amp;style=none&amp;taskId=u02b8394b-bcfe-4d13-a30d-14fe45d9820&amp;title=SAT%E6%A3%80%E6%B5%8B%E5%88%B0%E7%A2%B0%E6%92%9E%E5%B0%B1%E9%9D%99%E6%AD%A2&amp;width=1280" referrerpolicy="no-referrer" alt="image.png" title="SAT检测到碰撞就静止"></p><h2><a name="碰撞点检测--最近点法" class="md-header-anchor"></a><span>碰撞点检测--最近点法</span></h2><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/34451135/1669297800312-d01c313f-a9a8-4cc1-9b35-5ffeecfbce0c.jpeg" referrerpolicy="no-referrer">
<span>最近点法算法：</span></p><ul><li><p><img src="https://cdn.nlark.com/yuque/__latex/de1a824033d1643de101c9736ad1c271.svg#card=math&amp;code=%E4%B8%A4%E4%B8%AA%E5%88%9A%E4%BD%93%E5%8F%91%E7%94%9F%E7%A2%B0%E6%92%9E%EF%BC%8C%E6%AF%8F%E4%B8%AA%E5%88%9A%E4%BD%93%E4%B8%8A%E6%9C%80%E5%A4%9A%E6%9C%89%E4%B8%A4%E4%B8%AA%E7%A2%B0%E6%92%9E%E7%82%B9&amp;id=be17X" referrerpolicy="no-referrer"></p></li><li><p><img src="https://cdn.nlark.com/yuque/__latex/cc3ec2d93a3fc7728252359ad26da610.svg#card=math&amp;code=body1%E4%B8%8Ebody2%E5%8F%91%E7%94%9F%E7%A2%B0%E6%92%9E%EF%BC%8C%E7%A2%B0%E6%92%9E%E6%B3%95%E7%BA%BF%E4%B8%BA%5Cvec%7Bn%7D%2C%E6%B3%A8%E6%84%8F%E6%AD%A4%E6%97%B6%E7%9A%84%5Cvec%7Bn%7D%E6%98%AF%E4%B8%A4%E4%B8%AA%E5%88%9A%E4%BD%93%E5%85%B1%E7%94%A8%E7%9A%84&amp;id=XFiuO" referrerpolicy="no-referrer"></p></li><li><p><img src="https://cdn.nlark.com/yuque/__latex/b134b28af6763d95b111d48fb285998c.svg#card=math&amp;code=%E6%B1%82body1%E4%B8%8A%E7%9A%84%E7%A2%B0%E6%92%9E%E7%82%B9%EF%BC%8C%E5%A6%82%E6%9E%9C%E7%A2%B0%E6%92%9E%E6%B3%95%E7%BA%BF%5Cvec%7Bn%7D%E4%B8%8E%5Cvec%7BO_2O_1%7D%E5%A4%B9%E8%A7%92%E5%A4%A7%E4%BA%8E90%5E%E3%80%82%EF%BC%8C%E5%88%99%E6%B3%95%E7%BA%BF%E5%8F%96%E5%8F%8D%E5%90%91&amp;id=mgK4q" referrerpolicy="no-referrer"></p><ul><li><code>if np.dot(n,O2O1)&lt;0: n=-n</code></li></ul></li><li><p><img src="https://cdn.nlark.com/yuque/__latex/ce3b3ea451b4079cb40bdd826837a3ba.svg#card=math&amp;code=body1%E7%9A%84%E6%89%80%E6%9C%89%E9%A1%B6%E7%82%B9%E6%B1%82%5Cvec%7Bn%7D%E4%B8%8A%E7%9A%84%E6%8A%95%E5%BD%B1%EF%BC%8C%E6%8A%95%E5%BD%B1%E6%9C%80%E5%B0%8F%E5%80%BC%E5%AF%B9%E5%BA%94%E7%9A%84%E7%82%B9%E4%B8%BA%E7%A2%B0%E6%92%9E%E7%82%B9&amp;id=vwwCU" referrerpolicy="no-referrer"></p></li><li><p><img src="https://cdn.nlark.com/yuque/__latex/68f46a5ae053ae940607cecb895608ad.svg#card=math&amp;code=%E4%B8%8A%E4%B8%80%E6%AD%A5%E6%B1%82%E5%87%BA%E7%9A%84%E7%A2%B0%E6%92%9E%E7%82%B9p%E7%9A%84%E5%B7%A6%E5%8F%B3%E4%B8%A4%E4%B8%AA%E9%A1%B6%E7%82%B9%E4%B9%9F%E5%8F%AF%E8%83%BD%E6%98%AF%E7%A2%B0%E6%92%9E%E7%82%B9%E3%80%82%5C%5C%20%E6%A3%80%E6%B5%8Bp%E7%9A%84%E5%B7%A6%E5%8F%B3%E4%B8%A4%E4%B8%AA%E7%82%B9q_1%2Cq_2%E6%98%AF%E5%90%A6%E5%9C%A8body2%E5%86%85%E3%80%82%E8%8B%A5%E5%9C%A8%EF%BC%8C%E8%AF%A5%E7%82%B9%E4%B8%BA%E7%A2%B0%E6%92%9E%E7%82%B9&amp;id=rvP2P" referrerpolicy="no-referrer"></p></li></ul><p><img src="https://cdn.nlark.com/yuque/0/2022/png/34451135/1669302315522-9892ff23-65d7-4011-aa4a-6130b77b79e6.png#averageHue=%23696969&amp;clientId=uc09f08c5-d88e-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=751&amp;id=udcb7dd8f&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1127&amp;originWidth=1924&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=true&amp;size=92364&amp;status=done&amp;style=none&amp;taskId=u8fa96bd0-e962-45c4-9ee9-98c79567879&amp;title=%E6%98%BE%E7%A4%BA%E7%A2%B0%E6%92%9E%E7%82%B9%E5%8F%8A%E7%A2%B0%E6%92%9E%E6%B3%95%E7%BA%BF&amp;width=1282.6666666666667" referrerpolicy="no-referrer" alt="image.png" title="显示碰撞点及碰撞法线">
<span>最近点法的算法中需要检测一个点是否在多边形内，算法如下</span>
<span>检测点是否在多边形的算法：</span></p><ul><li><span>如果点在多边形的顶点上，返回TRUE</span></li><li><span>如果点在多边形的边上，返回TRUE</span></li><li><span>从点出发向右引一条射线，射线与多边形边相交数量为奇数，返回TRUE，否则返回FALSE</span></li></ul><p><img src="https://cdn.nlark.com/yuque/__latex/19094b2fc2ab10473da056182a215359.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26%E7%82%B9%E5%90%91%E5%8F%B3%E5%81%9A%E5%B0%84%E7%BA%BF%E4%B8%8E%E8%BE%B9%E6%9C%89%E4%BA%A4%E7%82%B9%EF%BC%8C%E9%A6%96%E5%85%88%E8%A6%81%E6%B1%82%20min%5C%7By_1%2Cy_2%5C%7D%3C%3Dy%3C%3Dmax%5C%7By_1%2Cy_2%5C%7D.%5C%5C%0A%26%E8%8B%A5%E6%BB%A1%E8%B6%B3%EF%BC%8C%E7%94%B1%E4%BB%A5%E4%B8%8B%E5%8E%9F%E7%90%86%E7%A1%AE%E5%AE%9A%E5%B0%84%E7%BA%BF%E6%98%AF%E5%90%A6%E4%B8%8E%E8%BE%B9%E7%9B%B8%E4%BA%A4%0A%5Cend%7Baligned%7D&amp;id=UIyOd" referrerpolicy="no-referrer">
<img src="https://cdn.nlark.com/yuque/__latex/9c7abbfe7dab1c166ec4d1f829af98eb.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26k%3D%5Cfrac%7By_0-y_1%7D%7Bx_0-x_1%7D%3D%5Cfrac%7By_1-y_2%7D%7Bx_1-x_2%7D%3By_0%3Dy%3B%0A%3D%3E%20x0%3Dx_1%2B%5Cfrac%7B1%7D%7Bk%7D%28y-y_1%29.%5C%5C%0A%26%E4%B8%8D%E5%A6%A8%E5%8F%96k%27%3D%5Cfrac%7Bx_1-x_2%7D%7By_1-y_2%7D%2C%E5%88%99%0Ax_0%3Dx_1%2Bk%27%28y-y1%29%3B%5C%5C%0A%26%E8%8B%A5x_0%3Ex%2C%E8%AF%B4%E6%98%8E%E4%BB%8E%28x%2Cy%29%E5%90%91%E5%8F%B3%E5%81%9A%E5%B0%84%E7%BA%BF%E4%B8%8E%E8%BE%B9%E6%9C%89%E4%BA%A4%E7%82%B9%0A%5Cend%7Baligned%7D&amp;id=Wc3L7" referrerpolicy="no-referrer">
<img src="https://cdn.nlark.com/yuque/0/2022/jpeg/34451135/1669542038634-f2742aa7-249f-4077-abed-d28497adbe78.jpeg" referrerpolicy="no-referrer">
<span>伪代码：</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 42px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>24</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">if_point_in_polygon</span>(<span class="cm-variable">p</span>,<span class="cm-variable">points_list</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">x</span>=<span class="cm-variable">p</span>.<span class="cm-property">x</span>() ; <span class="cm-variable">y</span>=<span class="cm-variable">p</span>.<span class="cm-property">y</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">count</span>=<span class="cm-builtin">len</span>(<span class="cm-variable">points_list</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">isInside</span>=<span class="cm-keyword">False</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">precision</span>=<span class="cm-number">0.01</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">i</span>=<span class="cm-number">0</span> ; <span class="cm-variable">j</span>=<span class="cm-variable">count</span><span class="cm-operator">-</span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">while</span> <span class="cm-variable">i</span><span class="cm-operator">&lt;</span><span class="cm-variable">count</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x1</span>=<span class="cm-variable">points_list</span>[<span class="cm-variable">i</span>].<span class="cm-property">x</span>() ; <span class="cm-variable">y1</span>=<span class="cm-variable">points_list</span>[<span class="cm-variable">i</span>].<span class="cm-property">y</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">x2</span>=<span class="cm-variable">points_list</span>[<span class="cm-variable">j</span>].<span class="cm-property">x</span>() ; <span class="cm-variable">y2</span>=<span class="cm-variable">points_list</span>[<span class="cm-variable">j</span>].<span class="cm-property">y</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>((<span class="cm-variable">x1</span>==<span class="cm-variable">x</span> <span class="cm-keyword">and</span> <span class="cm-variable">y1</span>==<span class="cm-variable">y</span>) <span class="cm-keyword">or</span> (<span class="cm-variable">x2</span>==<span class="cm-variable">x</span> <span class="cm-keyword">and</span> <span class="cm-variable">y2</span>==<span class="cm-variable">y</span>)):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">True</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#点与多边形的某个顶点重合</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>(<span class="cm-variable">y</span>==<span class="cm-variable">y1</span> <span class="cm-keyword">and</span> <span class="cm-variable">y</span>==<span class="cm-variable">y2</span>):<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#斜率不存在的边</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">x</span><span class="cm-operator">&gt;</span>=<span class="cm-builtin">min</span>(<span class="cm-variable">x1</span>,<span class="cm-variable">x2</span>) <span class="cm-keyword">and</span> <span class="cm-variable">x</span><span class="cm-operator">&lt;</span>=<span class="cm-builtin">max</span>(<span class="cm-variable">x1</span>,<span class="cm-variable">x2</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">True</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#点在斜率不存在的边上</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span>((<span class="cm-variable">y</span><span class="cm-operator">&gt;</span>=<span class="cm-variable">y1</span> <span class="cm-keyword">and</span> <span class="cm-variable">y</span><span class="cm-operator">&lt;</span><span class="cm-variable">y2</span>) <span class="cm-keyword">or</span> (<span class="cm-variable">y</span><span class="cm-operator">&lt;</span><span class="cm-variable">y1</span> <span class="cm-keyword">and</span> <span class="cm-variable">y</span><span class="cm-operator">&gt;</span>=<span class="cm-variable">y2</span>)):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">k</span>=(<span class="cm-variable">x2</span><span class="cm-operator">-</span><span class="cm-variable">x1</span>)<span class="cm-operator">/</span>(<span class="cm-variable">y2</span><span class="cm-operator">-</span><span class="cm-variable">y1</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">_x</span>=<span class="cm-variable">x1</span><span class="cm-operator">+</span><span class="cm-variable">k</span><span class="cm-operator">*</span>(<span class="cm-variable">y</span><span class="cm-operator">-</span><span class="cm-variable">y1</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">abs</span>(<span class="cm-variable">_x</span><span class="cm-operator">-</span><span class="cm-variable">x</span>)<span class="cm-operator">&lt;</span><span class="cm-variable">precision</span>:<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">#点在斜率为k的边上</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-keyword">True</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-variable">_x</span><span class="cm-operator">&gt;</span><span class="cm-variable">x</span>:<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#每出现一次交点，结果取反</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">isInside</span>=<span class="cm-keyword">not</span> <span class="cm-variable">isInside</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">j</span>=<span class="cm-variable">i</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">i</span>=<span class="cm-variable">i</span><span class="cm-operator">+</span><span class="cm-number">1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">isInside</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 631px;"></div><div class="CodeMirror-gutters" style="height: 631px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></pre><h2><a name="碰撞约束" class="md-header-anchor"></a><span>碰撞约束</span></h2><blockquote><p><span>碰撞约束参考： </span><a href='https://zhuanlan.zhihu.com/p/411876276'><span>https://zhuanlan.zhihu.com/p/411876276</span></a></p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/34451135/1669537512477-3b966944-98d8-4611-8df2-a15ab086ca0a.jpeg" referrerpolicy="no-referrer">
<span>如上图所示：</span>
<img src="https://cdn.nlark.com/yuque/__latex/c6d8c5cbb7be29c7a61b4b324143584d.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0Ar_a%20%26%3Dp_a-O_A%20%5C%5C%0Ar_b%20%26%3Dp_b-O_B%0A%5Cend%7Baligned%7D&amp;id=WhtoF" referrerpolicy="no-referrer">
<span>则：</span>
<img src="https://cdn.nlark.com/yuque/__latex/c1c9b4d330929f9c806c20ad2e9f24bc.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26v_%7Bp_a%7D%3Dv_a%2Bw_a%20%5Ctimes%20r_a%20%5C%5C%0A%26v_%7Bp_b%7D%3Dv_b%2Bw_b%20%5Ctimes%20r_b%0A%5Cend%7Baligned%7D&amp;id=v7uv5" referrerpolicy="no-referrer">
<span>为了使碰撞点分离，有约束方程及其求导方程：</span>
<img src="https://cdn.nlark.com/yuque/__latex/859d320e73438d24188180d30461ac67.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26C%3D%5Cvec%7Bn%7D%20%5Ccdot%5Cleft%28p_a-p_b%5Cright%29%3D0%20%5C%5C%0A%26%5Cdot%7BC%7D%3D%5Cvec%7Bn%7D%20%5Ccdot%5Cleft%28v_%7Bp_a%7D-v_%7Bp_b%7D%5Cright%29%3D0%0A%5Cend%7Baligned%7D&amp;id=BiUJ3" referrerpolicy="no-referrer">
<span>假设碰撞点处产生的冲量大小为</span><img src="https://cdn.nlark.com/yuque/__latex/d650cd55fb49faf5afb0b751b26fc746.svg#card=math&amp;code=%5Clambda_n&amp;id=UWqVF" referrerpolicy="no-referrer"><span>，则有动量方程和角动量方程：</span>
<img src="https://cdn.nlark.com/yuque/__latex/52fc739b3da77e8dbd8671b8d8152871.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26m_a%5Cleft%28v_a%5E%7B%5Cprime%7D-v_a%5Cright%29%3D%5Cvec%7Bn%7D%20%5Clambda_n%20%5C%5C%0A%26m_b%5Cleft%28v_b%5E%7B%5Cprime%7D-v_b%5Cright%29%3D-%5Cvec%7Bn%7D%20%5Clambda_n%20%5C%5C%0A%26I_a%5Cleft%28w_a%5E%7B%5Cprime%7D-w_a%5Cright%29%3D%5Cleft%28r_a%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Clambda_n%20%5C%5C%0A%26I_b%5Cleft%28w_b%5E%7B%5Cprime%7D-w_b%5Cright%29%3D-%5Cleft%28r_b%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Clambda_n%0A%5Cend%7Baligned%7D&amp;id=zIJTK" referrerpolicy="no-referrer">
<span>由上面的式子解出</span><img src="https://cdn.nlark.com/yuque/__latex/27577c40e9caa05eb75992dfbb82ad8d.svg#card=math&amp;code=v_%7Bpa%7D%27%2Cv_%7Bpb%7D%27&amp;id=gIIRu" referrerpolicy="no-referrer">
<img src="https://cdn.nlark.com/yuque/__latex/56ec3443b06a257db1d815b9ef0eb977.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26v_%7Bp_a%7D%5E%7B%5Cprime%7D%3Dv_a%27%2Bw_a%27%5Ctimes%20r_a%3D%20v_a%2B%5Cfrac%7B%5Cvec%7Bn%7D%20%5Clambda_n%7D%7Bm_a%7D%2B%5Cleft%28w_a%2B%5Cfrac%7B%5Cleft%28r_a%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Clambda_n%7D%7BI_a%7D%5Cright%29%20%5Ctimes%20r_a%20%5C%5C%0A%26v_%7Bp_b%7D%5E%7B%5Cprime%7D%3Dv_b%27%2Bw_b%27%5Ctimes%20r_b%3D%20v_b-%5Cfrac%7B%5Cvec%7Bn%7D%20%5Clambda_n%7D%7Bm_b%7D%2B%5Cleft%28w_b-%5Cfrac%7B%5Cleft%28r_b%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Clambda_n%7D%7BI_b%7D%5Cright%29%20%5Ctimes%20r_b%0A%5Cend%7Baligned%7D&amp;id=HzBCE" referrerpolicy="no-referrer">
<span>假设施加冲量后满足约束条件，则将</span><img src="https://cdn.nlark.com/yuque/__latex/27577c40e9caa05eb75992dfbb82ad8d.svg#card=math&amp;code=v_%7Bpa%7D%27%2Cv_%7Bpb%7D%27&amp;id=iD2U5" referrerpolicy="no-referrer"><span>带入约束方程：</span>
<img src="https://cdn.nlark.com/yuque/__latex/59358dc23eeb9d0afc2dc15bc65e7e5e.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%5Cdot%7BC%7D%26%3D%5Cvec%7Bn%7D%5Cleft%28v_%7Bp_a%7D%5E%7B%5Cprime%7D-v_%7Bp_b%7D%5E%7B%5Cprime%7D%5Cright%29%20%5C%5C%0A%26%3D%5Cvec%7Bn%7D%5Cleft%28v_%7Bp_a%7D-v_%7Bp_b%7D%5Cright%29%2B%5Clambda_n%5Cleft%28%5Cfrac%7B1%7D%7Bm_a%7D%2B%5Cfrac%7B1%7D%7Bm_b%7D%2B%5Cfrac%7B%5Cvec%7Bn%7D%5Cleft%28r_a%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Ctimes%20r_a%7D%7BI_a%7D%2B%5Cfrac%7B%5Cvec%7Bn%7D%5Cleft%28r_b%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Ctimes%20r_b%7D%7BI_b%7D%5Cright%29%20%5C%5C%0A%26%3D0%0A%5Cend%7Baligned%7D&amp;id=PRROh" referrerpolicy="no-referrer">
<span>由上式解得：</span>
<img src="https://cdn.nlark.com/yuque/__latex/a384ca6692a397f29572cb1a8dfe2259.svg#card=math&amp;code=%5Clambda_n%3D%5Cfrac%7B-%5Cvec%7Bn%7D%5Cleft%28v_%7Bp_a%7D-v_%7Bp_b%7D%5Cright%29%7D%7B%5Cfrac%7B1%7D%7Bm_a%7D%2B%5Cfrac%7B1%7D%7Bm_b%7D%2B%5Cfrac%7B%5Cvec%7Bn%7D%5Cleft%28r_a%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Ctimes%20r_a%7D%7BI_a%7D%2B%5Cfrac%7B%5Cvec%7Bn%7D%5Cleft%28r_b%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Ctimes%20r_b%7D%7BI_b%7D%7D&amp;id=QjLZ3" referrerpolicy="no-referrer">
<span>为了后续描述优化方案，约定有效质量为上式的分母：</span>
<img src="https://cdn.nlark.com/yuque/__latex/a4705f16e5b3298a8dcba322b38e06d5.svg#card=math&amp;code=M%5E%7B-1%7D%3D%5Cfrac%7B1%7D%7B%5Cfrac%7B1%7D%7Bm_a%7D%2B%5Cfrac%7B1%7D%7Bm_b%7D%2B%5Cfrac%7B%5Cvec%7Bn%7D%5Cleft%28r_a%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Ctimes%20r_a%7D%7BI_a%7D%2B%5Cfrac%7B%5Cvec%7Bn%7D%5Cleft%28r_b%20%5Ctimes%20%5Cvec%7Bn%7D%5Cright%29%20%5Ctimes%20r_b%7D%7BI_b%7D%7D&amp;id=nP1sV" referrerpolicy="no-referrer">
<span>上面求出了冲量的大小，点乘上碰撞法线</span><img src="https://cdn.nlark.com/yuque/__latex/551ce51ed5f8694611f42f8ac63191e0.svg#card=math&amp;code=%5Cbold%7Bn%7D&amp;id=eMcEn" referrerpolicy="no-referrer"><span>即为A收到的冲量。对A在碰撞点施加冲量即可。</span></p><pre spellcheck="false" class="md-fences md-end-block md-fences-with-lineno ty-contain-cm modeLoaded" lang="python" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="python"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 42px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 30px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>42</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: -30px; width: 30px;"></div><div class="CodeMirror-gutter-wrapper CodeMirror-activeline-gutter" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">coll_motion</span>(<span class="cm-variable">body1</span>,<span class="cm-variable">body2</span>,<span class="cm-variable">body1_coll_points_and_axes</span>,<span class="cm-variable">body2_coll_points_and_axes</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">body1</span>.<span class="cm-property">cal_parameter</span>()<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">#计算body1的质量、转动惯量、质量倒数等参数</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">body2</span>.<span class="cm-property">cal_parameter</span>()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">body1_coll_points_and_axes</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">imp</span>=<span class="cm-variable">cal_impulse</span>(<span class="cm-variable">body1</span>,<span class="cm-variable">body2</span>,<span class="cm-variable">i</span>[<span class="cm-number">0</span>],<span class="cm-variable">i</span>[<span class="cm-number">1</span>])<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">#计算冲量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">body1</span>.<span class="cm-property">apply_impulse</span>(<span class="cm-variable">imp</span>[<span class="cm-number">0</span>],<span class="cm-variable">imp</span>[<span class="cm-number">1</span>])<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">#对A实施冲量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">body2</span>.<span class="cm-property">apply_impulse</span>(<span class="cm-operator">-</span><span class="cm-variable">imp</span>[<span class="cm-number">0</span>],<span class="cm-variable">imp</span>[<span class="cm-number">2</span>])<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">#对B实施反向的冲量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">for</span> <span class="cm-variable">i</span> <span class="cm-keyword">in</span> <span class="cm-variable">body2_coll_points_and_axes</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">imp</span>=<span class="cm-variable">cal_new_state</span>(<span class="cm-variable">body2</span>,<span class="cm-variable">body1</span>,<span class="cm-variable">i</span>[<span class="cm-number">0</span>],<span class="cm-variable">i</span>[<span class="cm-number">1</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">body2</span>.<span class="cm-property">apply_impulse</span>(<span class="cm-variable">imp</span>[<span class="cm-number">0</span>],<span class="cm-variable">imp</span>[<span class="cm-number">1</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">body1</span>.<span class="cm-property">apply_impulse</span>(<span class="cm-operator">-</span><span class="cm-variable">imp</span>[<span class="cm-number">0</span>],<span class="cm-variable">imp</span>[<span class="cm-number">2</span>])</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">cal_impulse</span>(<span class="cm-variable">body1</span>,<span class="cm-variable">body2</span>,<span class="cm-variable">coll_point</span>,<span class="cm-variable">coll_axes</span>):</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-comment">#计算碰撞冲量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">normal</span>=<span class="cm-variable">pta</span>(<span class="cm-variable">coll_axes</span>)<span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">#QPointF =&gt;np.array() 碰撞法线</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">hight</span>=<span class="cm-variable">np</span>.<span class="cm-property">linalg</span>.<span class="cm-property">norm</span>(<span class="cm-variable">normal</span>)<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#碰撞深度</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pa</span>=<span class="cm-variable">pta</span>(<span class="cm-variable">coll_point</span>)<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#QPointF =&gt; np.array() 碰撞点</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">pb</span>=<span class="cm-variable">pa</span><span class="cm-operator">+</span><span class="cm-variable">normal</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">normal</span>=<span class="cm-variable">normal</span><span class="cm-operator">/</span><span class="cm-variable">np</span>.<span class="cm-property">linalg</span>.<span class="cm-property">norm</span>(<span class="cm-variable">normal</span>) &nbsp; &nbsp; <span class="cm-comment">#单位化碰撞法线</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ra</span>=<span class="cm-variable">pa</span><span class="cm-operator">-</span><span class="cm-variable">body1</span>.<span class="cm-property">position</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rb</span>=<span class="cm-variable">pb</span><span class="cm-operator">-</span><span class="cm-variable">body2</span>.<span class="cm-property">position</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im_a</span>=<span class="cm-variable">body1</span>.<span class="cm-property">invert_mass</span><span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">#质量的倒数</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">im_b</span>=<span class="cm-variable">body2</span>.<span class="cm-property">invert_mass</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ii_a</span>=<span class="cm-variable">body1</span>.<span class="cm-property">invert_inertia</span><span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">#转动惯量的倒数</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">ii_b</span>=<span class="cm-variable">body2</span>.<span class="cm-property">invert_inertia</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rn_a</span>=<span class="cm-variable">np</span>.<span class="cm-property">cross</span>(<span class="cm-variable">ra</span>,<span class="cm-variable">normal</span>)<span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">rn_b</span>=<span class="cm-variable">np</span>.<span class="cm-property">cross</span>(<span class="cm-variable">rb</span>,<span class="cm-variable">normal</span>) </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">k_normal</span>=<span class="cm-variable">im_a</span><span class="cm-operator">+</span><span class="cm-variable">ii_a</span><span class="cm-operator">*</span><span class="cm-variable">rn_a</span><span class="cm-operator">*</span><span class="cm-variable">rn_a</span><span class="cm-operator">+</span><span class="cm-variable">im_b</span><span class="cm-operator">+</span><span class="cm-variable">ii_b</span><span class="cm-operator">*</span><span class="cm-variable">rn_b</span><span class="cm-operator">*</span><span class="cm-variable">rn_b</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">28</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">if</span> <span class="cm-builtin">abs</span>(<span class="cm-variable">k_normal</span>)<span class="cm-operator">&lt;</span><span class="cm-number">1e-15</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">29</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">effective_mass</span>=<span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">30</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">else</span>:</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">31</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp;<span class="cm-variable">effective_mass</span>=<span class="cm-number">1.0</span><span class="cm-operator">/</span><span class="cm-variable">k_normal</span><span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-comment">#有效质量</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">32</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">angular_va</span>=<span class="cm-variable">body1</span>.<span class="cm-property">angular_velocity</span><span class="cm-tab" role="presentation" cm-text="	">   </span><span class="cm-comment">#角速度，double类型</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">33</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">angular_vb</span>=<span class="cm-variable">body2</span>.<span class="cm-property">angular_velocity</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">34</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" class="cm-tab-wrap-hack" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">wa</span>=<span class="cm-variable">cross</span>(<span class="cm-variable">angular_va</span>,<span class="cm-variable">ra</span>)<span class="cm-tab" role="presentation" cm-text="	"> </span><span class="cm-tab" role="presentation" cm-text="	">    </span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">35</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">wb</span>=<span class="cm-variable">cross</span>(<span class="cm-variable">angular_vb</span>,<span class="cm-variable">rb</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">36</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">va</span>=<span class="cm-variable">body1</span>.<span class="cm-property">v</span><span class="cm-operator">+</span><span class="cm-variable">wa</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">37</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">vb</span>=<span class="cm-variable">body2</span>.<span class="cm-property">v</span><span class="cm-operator">+</span><span class="cm-variable">wb</span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">38</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">dv</span>=<span class="cm-variable">va</span><span class="cm-operator">-</span><span class="cm-variable">vb</span><span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#相对速度</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">39</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">jv</span>=<span class="cm-variable">np</span>.<span class="cm-property">dot</span>(<span class="cm-variable">dv</span>,<span class="cm-variable">normal</span>)<span class="cm-tab" role="presentation" cm-text="	">    </span><span class="cm-comment">#相对速度在碰撞法线方向的投影，vpa-vpb</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">40</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">lambda_n</span>=<span class="cm-variable">effective_mass</span><span class="cm-operator">*</span>(<span class="cm-operator">-</span><span class="cm-variable">jv</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 20px;">41</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">impulse_n</span>=<span class="cm-variable">lambda_n</span><span class="cm-operator">*</span><span class="cm-variable">normal</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -30px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt CodeMirror-linenumber-show" style="left: 0px; width: 20px;">42</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-keyword">return</span> <span class="cm-variable">impulse_n</span>,<span class="cm-variable">ra</span>,<span class="cm-variable">rb</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 1112px;"></div><div class="CodeMirror-gutters" style="height: 1112px; left: 0px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div></div></pre><h2><a name="响应优化" class="md-header-anchor"></a><span>响应优化</span></h2><h3><a name="约束穿透深度对抗物体下跌" class="md-header-anchor"></a><span>约束穿透深度,对抗物体下跌</span></h3><p><span>由于计算机的模拟计算过程是线性非连续的，我们需要在计算当前冲量时，给相对速度增加一个项来避免物体下跌。假设我们允许的最大穿透深度为</span><img src="https://cdn.nlark.com/yuque/__latex/dcde50ba0f2ad1ab1fbf9c9a3bcd75ee.svg#card=math&amp;code=x_%7Bmax%7D&amp;id=F1n6P" referrerpolicy="no-referrer"><span>,当前的穿透深度为</span><img src="https://cdn.nlark.com/yuque/__latex/712ecf7894348e92d8779c3ee87eeeb0.svg#card=math&amp;code=x&amp;id=F6hU5" referrerpolicy="no-referrer"><span>,时间步长为</span><img src="https://cdn.nlark.com/yuque/__latex/becc4fcd9d0fe1d4c9363c6e000c53ed.svg#card=math&amp;code=%5CDelta%20t&amp;id=FXt9o" referrerpolicy="no-referrer"><span>, 则当</span><img src="https://cdn.nlark.com/yuque/__latex/5e0e1ea85cdb11eb9366903e133390ac.svg#card=math&amp;code=x-x_%7Bmax%7D%3E0&amp;id=QFsDg" referrerpolicy="no-referrer"><span>时，在</span><img src="https://cdn.nlark.com/yuque/__latex/d650cd55fb49faf5afb0b751b26fc746.svg#card=math&amp;code=%5Clambda_n&amp;id=v01xI" referrerpolicy="no-referrer"><span>的分子项上增加一个项</span><img src="https://cdn.nlark.com/yuque/__latex/ca8f6c1a83ce74ca5a1d2f13ac3cc086.svg#card=math&amp;code=%5Cbeta%20%5Cfrac%7Be%7D%7B%5CDelta%20t%7D&amp;id=owW0U" referrerpolicy="no-referrer"><span>,其中</span><img src="https://cdn.nlark.com/yuque/__latex/fcedf6333b7f4f02fa8a8e63c2c8c3b0.svg#card=math&amp;code=e%3Dmax%5C%7B0%2Cx-x_%7Bmax%7D%20%5C%7D&amp;id=x0jPy" referrerpolicy="no-referrer"><span>, </span><img src="https://cdn.nlark.com/yuque/__latex/6100158802e722a88c15efc101fc275b.svg#card=math&amp;code=%5Cbeta&amp;id=gwHr1" referrerpolicy="no-referrer"><span>是一个调节因子，新的冲量计算公式为:</span>
<img src="https://cdn.nlark.com/yuque/__latex/2b137d38be0f80b8cb0fe4866231ca42.svg#card=math&amp;code=%5Clambda_n%3DM%5E%7B-1%7D%5Cleft%28-%5Cvec%7Bn%7D%5Cleft%28v_%7Bp_a%7D-v_%7Bp_b%7D%5Cright%29%2B%5Cbeta%20%5Cfrac%7Be%7D%7B%5CDelta%20t%7D%5Cright%29%2Ce%3Dmax%5C%7B0%2Cx-x_%7Bmax%7D%5C%7D&amp;id=ah8kY" referrerpolicy="no-referrer"></p><h3><a name="摩擦冲量" class="md-header-anchor"></a><span>摩擦冲量</span></h3><p><span>加入摩擦力，在碰撞点处，用类似的方法计算摩擦冲量，摩擦冲量的方向为碰撞法线的垂直方向，与刚体在该方向上的相对速度方向相反</span>
<img src="https://cdn.nlark.com/yuque/__latex/3093587d8ded4953198dcb85d5825173.svg#card=math&amp;code=%5Cbegin%7Baligned%7D%0A%26%5Cvec%7Bt%7D%20%5Ccdot%20%5Cvec%7Bn%7D%3D0%20%5C%5C%0A%26M%5E%7B-1%7D%3D%5Cfrac%7B1%7D%7B%5Cfrac%7B1%7D%7Bm_a%7D%2B%5Cfrac%7B1%7D%7Bm_b%7D%2B%5Cfrac%7B%5Cvec%7Bt%7D%5Cleft%28r_a%20%5Ctimes%20%5Cvec%7Bt%7D%5Cright%29%20%5Ctimes%20r_a%7D%7BI_a%7D%2B%5Cfrac%7B%5Cvec%7Bt%7D%5Cleft%28r_b%20%5Ctimes%20%5Cvec%7Bt%7D%5Cright%29%20%5Ctimes%20r_b%7D%7BI_b%7D%7D%5C%5C%0A%26%5Clambda_t%3D-M%5E%7B-1%7D%20%5Cvec%7Bt%7D%5Cleft%28v_%7Bp_a%7D-v_%7Bp_b%7D%5Cright%29%0A%5Cend%7Baligned%7D&amp;id=Wp4Tt" referrerpolicy="no-referrer">
<span>效果展示，加入摩擦冲量后能在斜坡上基本静止。但效果不是很完美，物体还是会小幅度的沿斜面下滑，无法达到现实中静摩擦与动摩擦的区别效果。</span>
<img src="https://cdn.nlark.com/yuque/0/2022/png/34451135/1669541538669-fba1bf55-15ed-4d02-95f7-a652436e134f.png#averageHue=%23646463&amp;clientId=udf3ed078-b032-4&amp;crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;from=paste&amp;height=720&amp;id=u43d8ebf9&amp;margin=%5Bobject%20Object%5D&amp;name=image.png&amp;originHeight=1080&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=61674&amp;status=done&amp;style=none&amp;taskId=u0ef04664-3c00-4b6d-976a-ed3d1b943c6&amp;title=&amp;width=1280" referrerpolicy="no-referrer" alt="image.png"></p><h2><a name="创新性" class="md-header-anchor"></a><span>创新性</span></h2><ul><li><span>除了PyQt5界面引用了部分代码，其余代码均为自己编写</span></li><li><span>SAT实现细节参考了 </span><a href='https://github.com/phenomLi/Blog/issues/23'><span>https://github.com/phenomLi/Blog/issues/23 </span></a><span> 该链接中的文章给出了使用JS写的SAT碰撞检测伪代码，我用python将其转换为了具体实现 </span></li><li><span>最近点法求碰撞点算法为自己实现。</span></li><li><span>判断点是否在多边形内部为参考思想自己实现</span></li><li><span>碰撞响应算法为根据公式，自己实现，公式推导来源于参考文献([2]黎智洲. 基于最近支持点的碰撞检测算法研究与应用[D])</span></li><li><span>碰撞响应优化思想来源： </span><a href='https://zhuanlan.zhihu.com/p/411876276'><span>https://zhuanlan.zhihu.com/p/411876276</span></a></li></ul><h2><a name="讲解日期" class="md-header-anchor"></a><span>讲解日期</span></h2><p><strong><span>2022年12月15日</span></strong></p><p>&nbsp;</p></div>
</body>
</html>